import streamlit as st
import pandas as pd
import random

# ==========================================
# 1. é¡µé¢é…ç½®ä¸æ²‰æµ¸å¼æ ·å¼
# ==========================================
st.set_page_config(
    page_title="çœ¼ç§‘å…¨è€ƒç‚¹éœ¸éœ¸ (OphthMaster)",
    page_icon="ğŸ‘ï¸",
    layout="wide",
    initial_sidebar_state="expanded"
)

# æ³¨å…¥CSSï¼šæ‰“é€ ä¸“ä¸šå¤ä¹ ä½“éªŒ
st.markdown("""
<style>
    /* å…¨å±€å­—ä½“ä¸æ’ç‰ˆ */
    .stApp { font-family: 'Helvetica Neue', 'Microsoft YaHei', sans-serif; }
    h1, h2, h3 { color: #2c3e50; }
    
    /* æ ¸å¿ƒè€ƒç‚¹é«˜äº®å— (High Yield) */
    .highlight-box { 
        background-color: #e3f2fd; 
        padding: 15px; 
        border-radius: 8px; 
        border-left: 5px solid #2196f3; 
        margin-bottom: 15px;
        color: #0d47a1;
        font-weight: 500;
    }
    
    /* è®°å¿†å£è¯€å— (Mnemonics) */
    .mnemonic-box {
        background-color: #fffde7;
        padding: 15px;
        border-radius: 8px;
        border: 2px dashed #fbc02d;
        font-style: italic;
        margin-bottom: 15px;
        color: #f57f17;
    }
    
    /* é™·é˜±è­¦ç¤ºå— (Pitfalls) */
    .pitfall-box {
        background-color: #ffebee;
        padding: 15px;
        border-radius: 8px;
        border-left: 5px solid #f44336;
        margin-bottom: 15px;
        color: #b71c1c;
    }

    /* æœºåˆ¶è§£æå— (Mechanism) */
    .mech-box {
        background-color: #f3e5f5;
        padding: 15px;
        border-radius: 8px;
        border-left: 5px solid #9c27b0;
        margin-bottom: 15px;
        color: #4a148c;
    }
</style>
""", unsafe_allow_html=True)

# ==========================================
# 2. æ ¸å¿ƒçŸ¥è¯†åº“ (KNOWLEDGE_BASE)
#    åŸºäºæ–‡æ¡£å…¨é‡å†…å®¹æ„å»ºï¼ŒåŒ…å«æ‰€æœ‰ç»†èŠ‚
# ==========================================

KB = {
    # --- æ¨¡å—1ï¼šæ³ªæ¶²ç³»ç»Ÿ ---
    "tear_system": {
        "layers": {
            "columns": ["å±‚æ¬¡", "åç§°", "ä¸»è¦æ¥æº", "åŠŸèƒ½", "å¼‚å¸¸è¡¨ç° (è€ƒç‚¹)"],
            "data": [
                ["å¤–å±‚", "è„‚è´¨å±‚", "ç‘æ¿è…º (MGD)", "é˜²è’¸å‘ã€å¢åŠ è¡¨é¢å¼ åŠ›", "è’¸å‘è¿‡å¼ºå‹å¹²çœ¼ï¼ŒBUTç¼©çŸ­"],
                ["ä¸­å±‚", "æ°´æ¶²å±‚", "ä¸»/å‰¯æ³ªè…º", "ä¾›æ°§ã€è¥å…»ã€æŠ—èŒã€å†²æ´—", "æ°´æ¶²ç¼ºä¹å‹å¹²çœ¼ (Sjogren)"],
                ["å†…å±‚", "é»è›‹ç™½å±‚", "ç»“è†œæ¯çŠ¶ç»†èƒ", "äº²æ°´ç•Œé¢ï¼ˆåŒé¢èƒ¶ï¼‰", "æ³ªæ¶²æ— æ³•é“ºå±•ï¼Œå½¢æˆå¹²æ–‘"]
            ]
        },
        "dry_eye_class": {
            "columns": ["ç±»å‹", "æœºåˆ¶", "å¸¸è§ç—…å› "],
            "data": [
                ["æ°´æ¶²ç¼ºä¹å‹", "æ³ªè…ºåˆ†æ³Œâ€œæ°´â€ä¸å¤Ÿ", "Sjogrenç»¼åˆå¾ (SS)ã€ç±»é£æ¹¿ (RA)ã€SLE"],
                ["è’¸å‘è¿‡å¼ºå‹", "æ°´å¤Ÿä½†é”ä¸ä½ (æ²¹å°‘)", "ç‘æ¿è…ºåŠŸèƒ½éšœç¢ (MGDï¼Œæœ€å¸¸è§)ã€è§†é¢‘ç»ˆç«¯ç»¼åˆå¾ (VDT)"]
            ]
        },
        "tests": {
            "columns": ["æ£€æŸ¥é¡¹ç›®", "æ­£å¸¸å€¼", "ä¸´åºŠæ„ä¹‰"],
            "data": [
                ["BUT (æ³ªè†œç ´è£‚æ—¶é—´)", "> 10ç§’", "åæ˜ ç¨³å®šæ€§ï¼ˆæ²¹å±‚/é»è›‹ç™½å±‚ï¼‰ã€‚MGDå…¸å‹è¡¨ç°ã€‚"],
                ["Schirmer I è¯•éªŒ", "> 10mm/5min", "åæ˜ æ€»åˆ†æ³Œé‡ã€‚SSå…¸å‹è¡¨ç°ã€‚"],
                ["è§å…‰ç´ æŸ“è‰² (FL)", "é˜´æ€§", "é˜³æ€§æç¤ºè§’è†œä¸Šçš®ç¼ºæŸ (PEE)ã€‚"]
            ]
        }
    },

    # --- æ¨¡å—2ï¼šè§’è†œ ---
    "cornea": {
        "layers": {
            "columns": ["å±‚æ¬¡", "åç§°", "å†ç”Ÿèƒ½åŠ› (æ ¸å¿ƒè€ƒç‚¹)", "ç‰¹ç‚¹"],
            "data": [
                ["1", "ä¸Šçš®ç»†èƒå±‚", "âœ… æå¼ºï¼Œä¸ç•™ç—•", "å¯Œå«ç¥ç»ï¼Œç—›è§‰æ•é”ï¼›24-48hä¿®å¤"],
                ["2", "å‰å¼¹åŠ›å±‚", "âŒ ä¸å¯å†ç”Ÿ", "æŸä¼¤åå½¢æˆäº‘ç¿³/æ–‘ç¿³"],
                ["3", "åŸºè´¨å±‚", "âŒ ä¸å¯å†ç”Ÿ", "æœ€åš(90%)ï¼Œè§„åˆ™æ’åˆ—æ˜¯é€æ˜åŸºç¡€"],
                ["4", "åå¼¹åŠ›å±‚", "âœ… å¯å†ç”Ÿ", "åšéŸ§ï¼Œè€ä¾µèš€ (Descemetoceleè†¨å‡º)"],
                ["5", "å†…çš®ç»†èƒå±‚", "âŒ ä¸å¯å†ç”Ÿ (åªå¤§ä¸ç”Ÿäºº)", "æ³µåŠŸèƒ½ç»´æŒè„±æ°´ï¼›<500æ—¶å¤±ä»£å¿æ°´è‚¿"]
            ]
        },
        "keratitis": {
            "columns": ["é‰´åˆ«ç‚¹", "ç»†èŒæ€§", "çœŸèŒæ€§", "ç—…æ¯’æ€§ (HSV)"],
            "data": [
                ["å…¸å‹ç—…å²", "å¤–ä¼¤ã€éšå½¢çœ¼é•œã€å€’ç«", "æ¤ç‰©å¤–ä¼¤ (ç‰ç±³å¶/æ ‘æ)", "æ„Ÿå†’/å‘çƒ­åå¤å‘"],
                ["èµ·ç—…/ç—›æ„Ÿ", "æ€¥ï¼Œå‰§ç—›", "ç¼“ï¼Œç—‡çŠ¶è½»ä½“å¾é‡", "å¤å‘æ€§ï¼Œç—›æ„Ÿè½»(çŸ¥è§‰å‡é€€)"],
                ["åˆ†æ³Œç‰©", "å¤§é‡è„“æ€§", "å°‘ï¼Œç²˜ç¨ ", "æ°´æ ·"],
                ["æºƒç–¡å½¢æ€", "è¾¹ç•Œä¸æ¸…ï¼Œæ¹¿æ¶¦åæ­»", "å¹²ç‡¥ã€ç‰™è†æ ·ã€è¾¹ç•Œæ¸…", "æ ‘æçŠ¶ã€åœ°å›¾çŠ¶"],
                ["ç‰¹å¾æ€§ä½“å¾", "å‰æˆ¿ç§¯è„“(æµåŠ¨æ€§)", "ç¾½æ¯›çŠ¶ã€å«æ˜Ÿç¶ã€èŒä¸è‹”è¢«", "æœ«ç«¯è†¨å¤§ã€çŸ¥è§‰å‡é€€"],
                ["æ ¸å¿ƒè¯ç‰©", "å·¦æ°§æ°Ÿæ²™æ˜Ÿ/å¦¥å¸ƒéœ‰ç´ ", "çº³ä»–éœ‰ç´ /æ°Ÿåº·å”‘ (å¿Œæ¿€ç´ )", "æ›´æ˜”æ´›éŸ¦ (å¿Œæ¿€ç´ )"]
            ]
        }
    },

    # --- æ¨¡å—3ï¼šçº¢çœ¼é‰´åˆ« ---
    "red_eye": {
        "columns": ["é‰´åˆ«ç‚¹", "ç»“è†œå……è¡€ (Conjunctival)", "ç«çŠ¶å……è¡€ (Ciliary)"],
        "data": [
            ["è¡€ç®¡æ¥æº", "ç»“è†œååŠ¨è„‰ (æµ…)", "ç«çŠ¶å‰åŠ¨è„‰ (æ·±)"],
            ["å¤–è§‚", "é²œçº¢è‰²ï¼Œæ ‘æç½‘çŠ¶", "ç´«çº¢è‰²ï¼Œæ¯›åˆ·/æ”¾å°„çŠ¶"],
            ["éƒ¨ä½", "ç©¹éš†éƒ¨æ˜æ˜¾ï¼Œå‘è§’è†œå˜æ·¡", "è§’è†œç¼˜æ˜æ˜¾ï¼Œå‘åå˜æ·¡"],
            ["ç§»åŠ¨æ€§", "æ¨å¾—åŠ¨", "æ¨ä¸åŠ¨"],
            ["è‚¾ä¸Šè…ºç´ ", "æ•æ„Ÿ (ç«‹å³å˜ç™½)", "ä¸æ•æ„Ÿ"],
            ["ä¼´éšç—‡çŠ¶", "åˆ†æ³Œç‰©å¤šï¼Œè§†åŠ›å¥½", "ç—›ã€ç•å…‰ã€æµæ³ªï¼Œè§†åŠ›é™"],
            ["å¸¸è§ç—…", "ç»“è†œç‚", "è§’è†œç‚ã€è™¹ç«ç‚ã€é’å…‰çœ¼"]
        ]
    },

    # --- æ¨¡å—4ï¼šç™½å†…éšœä¸æ™¶çŠ¶ä½“ ---
    "cataract": {
        "stages": {
            "columns": ["åˆ†æœŸ", "å…³é”®ç‰¹å¾", "å¹¶å‘ç—‡/è€ƒç‚¹"],
            "data": [
                ["åˆå‘æœŸ", "æ¥”å½¢æ··æµŠ", "ä¸å½±å“è§†åŠ›"],
                ["è†¨èƒ€æœŸ", "æ™¶ä½“å¸æ°´è‚¿èƒ€", "è¯±å‘ã€æ€¥æ€§é—­è§’å‹é’å…‰çœ¼ã€‘ (é—¨å…³äº†)"],
                ["æˆç†ŸæœŸ", "å®Œå…¨æ··æµŠ", "çœ¼åº•çœ‹ä¸è§"],
                ["è¿‡ç†ŸæœŸ", "çš®è´¨æ¶²åŒ–ã€æ ¸ä¸‹æ²‰", "è¯±å‘ã€æ™¶çŠ¶ä½“æº¶è§£æ€§é’å…‰çœ¼ã€‘ (ä¸‹æ°´é“å µäº†)"]
            ]
        },
        "dislocation": {
            "columns": ["ç–¾ç—…", "é—ä¼ æ–¹å¼", "è„±ä½æ–¹å‘", "ä½“å‹ç‰¹å¾"],
            "data": [
                ["Marfanç»¼åˆå¾", "å¸¸æ˜¾ (AD)", "é¢ä¸Šæ–¹ (Up-Out)", "é«˜ç˜¦ã€èœ˜è››æŒ‡ã€ä¸»åŠ¨è„‰å¤¹å±‚"],
                ["åŒå‹åŠèƒ±æ°¨é…¸å°¿ç—‡", "å¸¸éš (AR)", "é¼»ä¸‹æ–¹ (Down-In)", "éª¨è´¨ç–æ¾ã€æ™ºåŠ›ä½ã€æ˜“è¡€æ “"],
                ["Weill-Marchesani", "å¸¸éš (AR)", "ä¸‹æ–¹", "èº«æçŸ®å°ã€çŸ­æŒ‡"]
            ]
        }
    },

    # --- æ¨¡å—5ï¼šè‘¡è„è†œç‚ ---
    "uveitis": {
        "class": {
            "columns": ["ç±»å‹", "ä¸»æˆ˜åœº", "ç‰¹å¾æ€§ä½“å¾"],
            "data": [
                ["å‰è‘¡è„è†œç‚", "å‰æˆ¿ (è™¹è†œ/ç«çŠ¶ä½“)", "KP (å°˜çŠ¶/ç¾Šè„‚çŠ¶)ã€æˆ¿æ°´é—ªè¾‰ (Tyndall)"],
                ["ä¸­é—´è‘¡è„è†œç‚", "ç»ç’ƒä½“", "é›ªçƒçŠ¶æ··æµŠ (Snowballs)ã€é£èšŠç—‡"],
                ["åè‘¡è„è†œç‚", "è§†ç½‘è†œ/è„‰ç»œè†œ", "çœ¼åº•ç—…ç¶ã€æ— ç—›æ€§è§†åŠ›ä¸‹é™"],
                ["å…¨è‘¡è„è†œç‚", "å…¨å±‚", "ç—…æƒ…æœ€é‡"]
            ]
        },
        "four_kings": [
            "**HLA-B27ç›¸å…³**ï¼šå¹´è½»ç”·æ€§ + å¼ºç›´æ€§è„ŠæŸ±ç‚ (AS) + æ€¥æ€§å‰è‘¡ã€‚",
            "**ç™½å¡ç—… (Behcet)**ï¼šå£è…”æºƒç–¡ + å¤–é˜´æºƒç–¡ + æ¸¸èµ°æ€§å‰æˆ¿ç§¯è„“ã€‚",
            "**VKHç»¼åˆå¾**ï¼šæ™šéœçŠ¶çœ¼åº• + ç™½å‘/ç™½ç™œé£ + å¬åŠ›ä¸‹é™ + åŒçœ¼å…¨è‘¡ã€‚",
            "**äº¤æ„Ÿæ€§çœ¼ç‚**ï¼šä¸€çœ¼ç©¿é€šä¼¤åï¼Œå¦ä¸€çœ¼ï¼ˆ2å‘¨-2æœˆï¼‰å‘ç”Ÿè‘¡è„è†œç‚ã€‚"
        ]
    },
    
    # --- æ¨¡å—6ï¼šçœ¼å¤–ä¼¤ ---
    "trauma": {
        "contusion": {
            "columns": ["æŸä¼¤éƒ¨ä½", "åç§°", "è¡¨ç°ä¸è€ƒç‚¹"],
            "data": [
                ["å‰æˆ¿", "å‰æˆ¿ç§¯è¡€", "åˆ†çº§çœ‹é«˜åº¦ï¼›åŠå§ä½ï¼›é˜²è§’è†œè¡€æŸ“/é’å…‰çœ¼"],
                ["è™¹è†œ", "æ ¹éƒ¨ç¦»æ–­", "ç³å­”å‘ˆ Då½¢"],
                ["æ™¶çŠ¶ä½“", "è„±ä½", "è™¹è†œéœ‡é¢¤"],
                ["è§†ç½‘è†œ", "è§†ç½‘è†œéœ‡è¡", "Berlinæ°´è‚¿ï¼šé»„æ–‘æ¨±æ¡ƒçº¢ï¼›å¯è‡ªæ„ˆ"]
            ]
        }
    },

    # --- è®°å¿†å£è¯€åº“ ---
    "mnemonics": [
        "ã€ç»“è†œå……è¡€ã€‘ç»“è†œé²œçº¢ç©¹éš†èµ·ï¼Œæ¨ä¹‹èƒ½åŠ¨è‚¾ä¸Šæ¶ˆï¼Œåˆ†æ³Œç‰©å¤šè§†åŠ›å¥½ã€‚",
        "ã€ç«çŠ¶å……è¡€ã€‘ç«çŠ¶ç´«çº¢è§’è†œç»•ï¼Œæ¨ä¹‹ä¸åŠ¨éš¾æ¶ˆé€€ï¼Œç—›ç•æµæ³ªè§†åŠ›æ‰ã€‚",
        "ã€æ³ªè†œã€‘å¤–æ²¹ä¸­æ°´å†…é»è†œï¼Œæ²¹é˜²è’¸å‘æ°´ä¾›å…»ï¼Œé»æŠ“è§’è†œã€‚",
        "ã€è§’è†œã€‘ä¸Šçš®å†ç”Ÿä¸ç•™ç—•ï¼Œå‰å¼¹åŸºè´¨ç•™ç–¤ç—•ï¼›åå¼¹åšéŸ§é˜²ç©¿å­”ï¼Œå†…çš®åªå¤§ä¸ç”Ÿäººã€‚",
        "ã€è§’è†œç‚ã€‘ç»†èŒæ€¥è„“æ€§å¤šï¼ŒçœŸèŒç¼“ç¾½æ¯›æ‰©ï¼Œç—…æ¯’å¤æ ‘æé•¿ã€‚",
        "ã€è„±ä½ã€‘Marfan é«˜å¯Œå¸…å¾€ä¸Šçœ‹ï¼ˆå¤–ä¸Šï¼‰ï¼›åŒå‹ å‚»ç™½ç”œå¾€ä¸‹çœ‹ï¼ˆå†…ä¸‹ï¼‰ã€‚",
        "ã€è‘¡è„è†œç‚ã€‘è…°ç–¼B27ç”·å‰æˆ¿ï¼Œå£è…”æºƒç–¡ç™½å¡å¿™ï¼Œæ™šéœç™½å‘VKHã€‚"
    ]
}

# ==========================================
# 3. è¾…åŠ©ç»„ä»¶å‡½æ•°
# ==========================================

def render_table(data_dict, blind_mode=False):
    """æ¸²æŸ“è¡¨æ ¼ï¼Œæ”¯æŒé®æŒ¡æ¨¡å¼"""
    df = pd.DataFrame(data_dict["data"], columns=data_dict["columns"])
    if blind_mode:
        # åªæ˜¾ç¤ºç¬¬ä¸€åˆ—ï¼Œå…¶ä»–åˆ—é®æŒ¡
        st.dataframe(df.iloc[:, [0]], use_container_width=True)
        st.info("ğŸ™ˆ é®æŒ¡æ¨¡å¼å·²å¼€å¯ï¼Œè¯·å°è¯•å›å¿†è¯¦ç»†å†…å®¹...")
    else:
        st.dataframe(df, use_container_width=True)

def render_box(type, title, text):
    if type == "highlight":
        st.markdown(f'<div class="highlight-box">ğŸ“Œ <b>{title}</b><br>{text}</div>', unsafe_allow_html=True)
    elif type == "pitfall":
        st.markdown(f'<div class="pitfall-box">âš ï¸ <b>{title}</b><br>{text}</div>', unsafe_allow_html=True)
    elif type == "mech":
        st.markdown(f'<div class="mech-box">âš™ï¸ <b>{title}</b><br>{text}</div>', unsafe_allow_html=True)
    elif type == "mnemonic":
        st.markdown(f'<div class="mnemonic-box">ğŸ”” <b>å£è¯€ï¼š</b>{text}</div>', unsafe_allow_html=True)

# ==========================================
# 4. ä¸»ç¨‹åºé€»è¾‘
# ==========================================

# --- ä¾§è¾¹æ  ---
with st.sidebar:
    st.title("ğŸ‘ï¸ OphthMaster")
    st.caption("åŸºäºæ–‡æ¡£çš„å…¨é‡è€ƒç‚¹åº“")
    
    menu = st.radio(
        "å¤ä¹ ç« èŠ‚",
        ["ğŸ  é¦–é¡µ", "ğŸ’§ æ³ªæ¶²ä¸è§’è†œ", "ğŸ”´ çº¢çœ¼ä¸è§’è†œç‚", "ğŸŒ‘ æ™¶çŠ¶ä½“ä¸ç™½å†…éšœ", "ğŸ”¥ è‘¡è„è†œç‚", "ğŸš‘ çœ¼å¤–ä¼¤", "âš”ï¸ ç—…ä¾‹å®æˆ˜", "ğŸ’ è®°å¿†å£è¯€"]
    )
    
    st.divider()
    st.success(f"ğŸ’¡ **éšæœºå£è¯€ï¼š**\n{random.choice(KB['mnemonics'])}")

# --- é¡µé¢è·¯ç”± ---

if "é¦–é¡µ" in menu:
    st.title("çœ¼ç§‘å…¨è€ƒç‚¹éœ¸éœ¸")
    st.markdown("### *Slogan: ä¸åªæ˜¯èµ„æ–™ï¼Œè€Œæ˜¯ä½ çš„å¤–æŒ‚è„‘ã€‚*")
    st.info("åŒå­¦ä½ å¥½ï¼è¿™ä¸ªç‰ˆæœ¬å·²ç»ä¸ä»…æ˜¯éª¨æ¶ï¼Œè€Œæ˜¯å¡«å……äº†æ–‡æ¡£ä¸­æ‰€æœ‰å…³äºæœºåˆ¶ã€é‰´åˆ«å’Œæ²»ç–—çš„ç»†èŠ‚ã€‚")
    
    c1, c2 = st.columns(2)
    with c1:
        render_box("highlight", "é«˜åˆ†ç­–ç•¥", "1. å…ˆçœ‹ã€è§£å‰–ã€‘ï¼Œç†è§£äº†è¡€ç®¡èµ°è¡Œï¼Œçº¢çœ¼é‰´åˆ«å°±ä¸ç”¨èƒŒã€‚\n2. é‡ç‚¹èƒŒè¯µã€æ™¶çŠ¶ä½“ã€‘æ¨¡å—çš„å››æœŸå¹¶å‘ç—‡ã€‚\n3. ã€ç—…ä¾‹å®æˆ˜ã€‘ç”¨æ¥æ£€éªŒä½ çš„ä¸´åºŠç›´è§‰ã€‚")
    with c2:
        render_box("pitfall", "å¸¸è§æ­»ç©´", "âŒ ç—…æ¯’æ€§è§’è†œç‚ä¸Šçš®æœŸç”¨æ¿€ç´  -> ç©¿å­”ï¼\nâŒ ç¢±çƒ§ä¼¤æ²¡å†²æ´—å°±è½¬é™¢ -> å¤±æ˜ï¼\nâŒ é’å…‰çœ¼åªçœ‹çœ¼å‹ -> æ¼è¯Šä½çœ¼å‹æ€§é’å…‰çœ¼ï¼")

elif "æ³ªæ¶²" in menu:
    st.title("ğŸ’§ æ³ªæ¶²ä¸è§’è†œ (Anatomy)")
    tab1, tab2 = st.tabs(["æ³ªæ¶²ç³»ç»Ÿ", "è§’è†œäº”å±‚æ¥¼"])
    
    with tab1:
        st.subheader("1. æ³ªè†œä¸‰å±‚ç»“æ„")
        st.write("ç›´æ¥å…³è”å¹²çœ¼ç—‡åˆ†ç±»ã€‚ä»å¤–å‘å†…ï¼š")
        render_table(KB["tear_system"]["layers"])
        render_box("mech", "æœºåˆ¶", "é»è›‹ç™½åƒåŒé¢èƒ¶ï¼Œä¸€ç«¯æŠ“ç–æ°´çš„è§’è†œä¸Šçš®ï¼Œä¸€ç«¯æŠ“æ°´ï¼Œé˜²æ­¢æ³ªæ¶²æ»‘è½ã€‚")
        
        st.subheader("2. å¹²çœ¼ç—‡åˆ†ç±» (ADDE vs EDE)")
        render_table(KB["tear_system"]["dry_eye_class"])
        
    with tab2:
        st.subheader("1. è§’è†œäº”å±‚ç»“æ„")
        render_box("mnemonic", KB["mnemonics"][3], "")
        render_table(KB["cornea"]["layers"])
        st.markdown("**è€ƒç‚¹ï¼š** å†…çš®ç»†èƒä¸å¯å†ç”Ÿï¼Œæ‰‹æœ¯æŸä¼¤åä¼šå¯¼è‡´æ°¸ä¹…æ€§å¤§æ³¡æ€§è§’è†œç—…å˜ã€‚")

elif "çº¢çœ¼" in menu:
    st.title("ğŸ”´ çº¢çœ¼ä¸è§’è†œç‚")
    blind = st.toggle("ğŸ›¡ï¸ å¼€å¯é®æŒ¡æ¨¡å¼ (èƒŒè¯µç”¨)")
    
    st.subheader("1. å……è¡€é‰´åˆ« (å¿…è€ƒ)")
    render_table(KB["red_eye"], blind_mode=blind)
    render_box("mech", "ä¸ºä»€ä¹ˆç»“è†œå……è¡€æ¨å¾—åŠ¨ï¼Ÿ", "å› ä¸ºè¡€ç®¡ä½äºç–æ¾çš„ç»“è†œå›ºæœ‰å±‚ï¼›è€Œç«çŠ¶è¡€ç®¡ä½äºæ·±å±‚å·©è†œï¼Œä½ç½®å›ºå®šã€‚")
    
    st.markdown("---")
    st.subheader("2. æ„ŸæŸ“æ€§è§’è†œç‚é‰´åˆ«")
    st.write("çœ‹åˆ°â€œç¾½æ¯›çŠ¶â€é€‰çœŸèŒï¼Œçœ‹åˆ°â€œæ ‘æçŠ¶â€é€‰ç—…æ¯’ã€‚")
    render_table(KB["cornea"]["keratitis"], blind_mode=blind)
    render_box("pitfall", "æ¿€ç´ ç¦å¿Œ", "HSVè§’è†œç‚ï¼ˆæ ‘æçŠ¶ï¼‰ç»å¯¹ç¦ç”¨æ¿€ç´ ï¼å¦åˆ™ç—…æ¯’æ‰©æ•£å¯¼è‡´ç©¿å­”ã€‚")

elif "æ™¶çŠ¶ä½“" in menu:
    st.title("ğŸŒ‘ æ™¶çŠ¶ä½“ä¸ç™½å†…éšœ")
    
    st.subheader("1. ç™½å†…éšœå››æœŸæ¼”å˜")
    render_table(KB["cataract"]["stages"])
    render_box("highlight", "é’å…‰çœ¼å¹¶å‘ç—‡", 
               "- **è†¨èƒ€æœŸ**ï¼šæ™¶ä½“è‚¿ -> æˆ¿è§’å…³ -> æ€¥æ€§é—­è§’å‹é’å…‰çœ¼ã€‚\n"
               "- **è¿‡ç†ŸæœŸ**ï¼šè›‹ç™½æ¼ -> å µå°æ¢ -> æ™¶çŠ¶ä½“æº¶è§£æ€§é’å…‰çœ¼ã€‚")
    
    st.subheader("2. æ™¶çŠ¶ä½“è„±ä½ä¸å…¨èº«ç—…")
    render_table(KB["cataract"]["dislocation"])
    render_box("mnemonic", KB["mnemonics"][5], "")

elif "è‘¡è„è†œç‚" in menu:
    st.title("ğŸ”¥ è‘¡è„è†œç‚ (Uveitis)")
    
    st.subheader("1. å›½é™…SUNåˆ†ç±»")
    render_table(KB["uveitis"]["class"])
    
    st.subheader("2. å…ç–«æ€§è‘¡è„è†œç‚ (å››å¤§é‡‘åˆš)")
    for item in KB["uveitis"]["four_kings"]:
        st.info(item)
    
    st.subheader("3. æ ¸å¿ƒä½“å¾")
    st.markdown("- **KP (è§’è†œåæ²‰ç€ç‰©)**ï¼šå°˜çŠ¶æç¤ºéè‚‰èŠ½è‚¿æ€§ (HLA-B27)ï¼Œç¾Šè„‚çŠ¶æç¤ºè‚‰èŠ½è‚¿æ€§ (ç»“æ ¸/æ¢…æ¯’)ã€‚")

elif "çœ¼å¤–ä¼¤" in menu:
    st.title("ğŸš‘ çœ¼å¤–ä¼¤æ€¥æ•‘")
    
    st.subheader("1. åŒ–å­¦çƒ§ä¼¤")
    st.error("ğŸš¨ **äº‰åˆ†å¤ºç§’ï¼Œå°±åœ°å†²æ´—ï¼** è‡³å°‘30åˆ†é’Ÿã€‚ç¢±çƒ§ä¼¤æ›´ä¸¥é‡ï¼ˆæº¶è§£è„‚è‚ªå‘æ·±éƒ¨æ¸—é€ï¼‰ã€‚")
    
    st.subheader("2. é’æŒ«ä¼¤ (éš”å±±æ‰“ç‰›)")
    render_table(KB["trauma"]["contusion"])

elif "ç—…ä¾‹å®æˆ˜" in menu:
    st.title("âš”ï¸ ä¸´åºŠæ€ç»´å®æˆ˜")
    
    with st.expander("ç—…ä¾‹ 1ï¼šå†œæ°‘ä¼¯ä¼¯çš„é­é‡", expanded=True):
        st.write("æ‚£è€…ç”·æ€§ï¼Œå†œæ°‘ã€‚å³çœ¼çº¢ç—›ã€è§†åŠ›ä¸‹é™10å¤©ã€‚æ”¶å‰²ç‰ç±³æ—¶è¢«å¶ç‰‡åˆ’ä¼¤ã€‚æŸ¥ä½“ï¼šæ··åˆå……è¡€ï¼Œè§’è†œä¸­å¤®ç°ç™½æºƒç–¡ï¼Œè¡¨é¢å¹²ç‡¥ï¼Œè¾¹ç¼˜å‘ˆç¾½æ¯›çŠ¶ã€‚")
        ans1 = st.radio("ä½ çš„è¯Šæ–­ï¼Ÿ", ["ç»†èŒæ€§è§’è†œç‚", "çœŸèŒæ€§è§’è†œç‚", "ç—…æ¯’æ€§è§’è†œç‚"], key="c1")
        if st.button("æäº¤ç—…ä¾‹1"):
            if ans1 == "çœŸèŒæ€§è§’è†œç‚":
                st.success("âœ… æ­£ç¡®ï¼å…³é”®è¯ï¼šæ¤ç‰©å¤–ä¼¤ + ç¾½æ¯›çŠ¶/å¹²ç‡¥ = çœŸèŒã€‚")
            else:
                st.error("âŒ é”™è¯¯ã€‚æç¤ºï¼šæ³¨æ„æ¤ç‰©å¤–ä¼¤å²å’Œ'ç¾½æ¯›çŠ¶'ç‰¹å¾ã€‚")

    with st.expander("ç—…ä¾‹ 2ï¼šè…°ç—›çš„å¹´è½»äºº"):
        st.write("25å²ç”·æ€§ï¼Œåå¤è…°éª¶éƒ¨ç–¼ç—›ä¼´æ™¨åƒµ3å¹´ã€‚ç°çªå‘å³çœ¼çº¢ç—›ã€‚æŸ¥ä½“ï¼šç«çŠ¶å……è¡€ï¼ŒKP(+)ã€‚
